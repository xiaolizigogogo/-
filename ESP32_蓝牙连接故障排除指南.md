# ESP32 蓝牙连接故障排除指南

## 问题现象
ESP32蓝牙测试程序运行正常，但手机搜索不到蓝牙设备。

## 可能原因分析

### 1. 蓝牙初始化问题
- ESP32蓝牙模块未正确初始化
- 蓝牙服务未正确启动
- 设备名称设置失败

### 2. 设备发现问题
- 蓝牙设备未设置为可发现状态
- 配对模式配置错误
- 蓝牙协议版本不兼容

### 3. 硬件问题
- ESP32蓝牙硬件故障
- 天线连接问题
- 电源供应不稳定

## 解决方案

### 方案1：重新配置蓝牙设置
```cpp
// 在setup()函数中添加
SerialBT.enableSSP();
SerialBT.setPin("1234", 4);
```

### 方案2：检查蓝牙初始化
```cpp
// 添加蓝牙状态检查
if (SerialBT.begin(BT_DEVICE_NAME)) {
    Serial.println("蓝牙初始化成功");
    // 设置可发现状态
    SerialBT.enableSSP();
    SerialBT.setPin("1234", 4);
} else {
    Serial.println("蓝牙初始化失败");
}
```

### 方案3：使用不同的设备名称
```cpp
// 尝试更简单的设备名称
const char* BT_DEVICE_NAME = "ESP32";
```

### 方案4：添加蓝牙状态监控
```cpp
// 定期检查蓝牙状态
void checkBluetoothStatus() {
    if (!SerialBT.hasClient()) {
        SerialBT.enableSSP();
        SerialBT.setPin("1234", 4);
    }
}
```

## 手机端操作步骤

### Android手机
1. 打开设置 → 蓝牙
2. 确保蓝牙已开启
3. 点击"搜索设备"或"扫描"
4. 等待设备出现
5. 点击设备名称进行配对
6. 输入配对密码：1234

### iPhone
1. 打开设置 → 蓝牙
2. 确保蓝牙已开启
3. 等待设备自动搜索
4. 点击设备名称进行配对
5. 输入配对密码：1234

## 常见问题解决

### 问题1：搜索不到设备
**解决方法：**
- 重启ESP32
- 清除手机蓝牙缓存
- 尝试不同的设备名称
- 检查ESP32与手机距离

### 问题2：配对失败
**解决方法：**
- 确认配对密码正确
- 重启蓝牙设备
- 清除之前的配对记录
- 尝试重新配对

### 问题3：连接不稳定
**解决方法：**
- 检查电源供应
- 减少干扰源
- 调整设备位置
- 更新蓝牙驱动

## 调试技巧

### 1. 串口监控
- 观察蓝牙初始化日志
- 检查错误信息
- 监控连接状态变化

### 2. 蓝牙测试工具
- 使用蓝牙调试APP
- 测试不同蓝牙协议
- 验证设备兼容性

### 3. 硬件检查
- 测量电源电压
- 检查天线连接
- 测试其他蓝牙设备

## 预防措施

### 1. 代码优化
- 添加错误处理
- 实现自动重连
- 优化蓝牙配置

### 2. 硬件保护
- 使用稳定电源
- 避免电磁干扰
- 保持适当距离

### 3. 软件更新
- 定期更新ESP32固件
- 使用最新蓝牙库
- 优化代码性能

## 联系支持
如果问题仍然存在，请提供：
1. 完整的串口输出日志
2. 手机型号和系统版本
3. ESP32开发板型号
4. 使用的Arduino IDE版本
5. 详细的错误描述
