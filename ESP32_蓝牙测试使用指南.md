# ESP32 蓝牙测试程序使用指南

## 程序功能
这是一个简单的ESP32蓝牙连接测试程序，不依赖Mega2560，可以独立运行。

## 主要特性
- 蓝牙串口通信
- JSON格式数据交互
- 系统状态监控
- 多种测试命令
- 心跳机制

## 硬件要求
- ESP32开发板
- USB数据线
- 支持蓝牙的设备（手机/电脑）

## 安装步骤

### 1. 库文件安装
确保已安装以下库：
- `BluetoothSerial` (ESP32内置)
- `ArduinoJson` (需要安装)

### 2. 代码上传
1. 打开Arduino IDE
2. 选择开发板：ESP32 Dev Module
3. 选择正确的端口
4. 上传代码

## 使用方法

### 1. 启动程序
1. 上传代码后，打开串口监视器
2. 波特率设置为115200
3. 程序会自动初始化蓝牙

### 2. 蓝牙连接
1. 在手机或电脑上搜索蓝牙设备
2. 找到设备：`ESP32_Bluetooth_Test`
3. 配对密码：`1234`
4. 连接成功后，串口会显示连接状态

### 3. 测试命令
通过蓝牙发送以下命令进行测试：

#### 基本命令
- `status` - 获取系统状态
- `test` - 测试蓝牙通信
- `info` - 获取详细系统信息
- `ping` - 测试连接（返回pong）

#### 高级命令
- `echo:消息内容` - 回显测试
- 其他任何消息 - 显示可用命令列表

## 响应格式
所有响应都是JSON格式，包含以下字段：
- `type` - 响应类型
- `timestamp` - 时间戳
- 其他相关数据

### 示例响应
```json
{
  "type": "status",
  "bluetooth_connected": true,
  "command_count": 5,
  "free_heap": 118208,
  "cpu_temp": 53.33,
  "uptime": 30000,
  "timestamp": 30000
}
```

## 心跳机制
程序每5秒自动发送心跳包，包含：
- 连接状态
- 命令计数
- 系统资源信息
- CPU温度

## 故障排除

### 1. 蓝牙初始化失败
- 检查ESP32硬件
- 重启ESP32
- 检查代码是否正确上传

### 2. 无法连接蓝牙
- 确认设备名称：`ESP32_Bluetooth_Test`
- 确认配对密码：`1234`
- 重启蓝牙设备
- 清除之前的配对记录

### 3. 通信异常
- 检查JSON格式是否正确
- 确认命令拼写正确
- 查看串口输出错误信息

## 扩展功能
可以基于此程序添加：
- WiFi功能
- 传感器数据读取
- 文件系统操作
- 更多通信协议

## 注意事项
- 程序不依赖Mega2560
- 蓝牙连接需要配对
- 心跳间隔为5秒
- 系统状态每10秒更新一次
- 支持JSON格式数据交互

## 技术支持
如遇问题，请检查：
1. 串口输出信息
2. 蓝牙连接状态
3. 命令格式是否正确
4. 系统资源是否充足
