# Mega2560 + ESP32 接线指南

## 🎯 系统概述

本指南详细说明如何将ESP32模块连接到Arduino Mega2560，实现两个Mega2560设备之间的无线通信。

## 🔌 硬件连接

### 1. Mega2560与ESP32连接

#### 主设备连接
```
Mega2560主设备          ESP32桥接模块
─────────────────      ──────────────
TX2 (Pin 16)      →    RX (Pin 3)
RX2 (Pin 17)      ←    TX (Pin 1)
GND               →    GND
5V                →    VIN (或3.3V)
```

#### 从设备连接
```
Mega2560从设备          ESP32桥接模块
─────────────────      ──────────────
TX2 (Pin 16)      →    RX (Pin 3)
RX2 (Pin 17)      ←    TX (Pin 1)
GND               →    GND
5V                →    VIN (或3.3V)
```

### 2. ESP32状态指示连接

```
ESP32              LED指示灯
─────────          ──────────
GPIO2          →   正极
GND            →   负极
```

### 3. 从设备硬件扩展连接

```
Mega2560从设备          扩展硬件
─────────────────      ──────────
Pin 4            →    继电器控制
Pin 13           →    LED指示灯
Pin 5            →    电机控制
A0               →    传感器输入
Pin 2            →    状态指示LED
```

## ⚡ 电源供应

### 1. 主设备电源
- **Mega2560**: 7-12V DC输入
- **ESP32**: 通过Mega2560的5V输出供电
- **总功率**: 约2-3W

### 2. 从设备电源
- **Mega2560**: 7-12V DC输入
- **ESP32**: 通过Mega2560的5V输出供电
- **扩展硬件**: 根据实际需求供电
- **总功率**: 约3-5W

## 🔧 连接步骤

### 步骤1: 准备硬件
1. 准备2个Arduino Mega2560开发板
2. 准备2个ESP32开发板
3. 准备连接线材（杜邦线）
4. 准备电源适配器

### 步骤2: 连接主设备
1. 将ESP32的RX连接到Mega2560的TX1 (Pin 18)
2. 将ESP32的TX连接到Mega2560的RX1 (Pin 19)
3. 将ESP32的GND连接到Mega2560的GND
4. 将ESP32的VIN连接到Mega2560的5V
5. 将状态指示LED连接到ESP32的GPIO2

### 步骤3: 连接从设备
1. 重复步骤2的连接
2. 连接扩展硬件：
   - 继电器连接到Pin 4
   - LED连接到Pin 13
   - 电机连接到Pin 5
   - 传感器连接到A0
   - 状态LED连接到Pin 2

### 步骤4: 电源连接
1. 为主设备Mega2560连接7-12V电源
2. 为从设备Mega2560连接7-12V电源
3. 检查电源指示灯

## 📋 接线检查清单

### 主设备检查
- [ ] ESP32 RX → Mega2560 TX2 (Pin 16)
- [ ] ESP32 TX → Mega2560 RX2 (Pin 17)
- [ ] ESP32 GND → Mega2560 GND
- [ ] ESP32 VIN → Mega2560 5V
- [ ] 状态LED → ESP32 GPIO2
- [ ] 电源连接正确
- [ ] 所有连接牢固

### 从设备检查
- [ ] ESP32 RX → Mega2560 TX2 (Pin 16)
- [ ] ESP32 TX → Mega2560 RX2 (Pin 17)
- [ ] ESP32 GND → Mega2560 GND
- [ ] ESP32 VIN → Mega2560 5V
- [ ] 状态LED → ESP32 GPIO2
- [ ] 继电器 → Pin 4
- [ ] LED → Pin 13
- [ ] 电机 → Pin 5
- [ ] 传感器 → A0
- [ ] 状态LED → Pin 2
- [ ] 电源连接正确
- [ ] 所有连接牢固

## ⚠️ 注意事项

### 1. 电压兼容性
- **ESP32工作电压**: 3.3V
- **Mega2560输出**: 5V
- **解决方案**: 使用ESP32的VIN引脚，内部有电压调节器

### 2. 串口通信
- **波特率**: 115200
- **数据位**: 8
- **停止位**: 1
- **校验位**: 无

### 3. 电源要求
- **Mega2560**: 7-12V DC，至少1A
- **ESP32**: 3.3V，约500mA
- **总功率**: 主设备2-3W，从设备3-5W

### 4. 连接质量
- 使用质量好的杜邦线
- 确保连接牢固
- 避免接触不良

## 🔍 故障排除

### 1. 通信问题
**症状**: ESP32无法与Mega2560通信
**检查**:
- 确认TX/RX连接正确
- 检查波特率设置
- 验证电源供应

**解决**:
- 重新检查连接
- 调整波特率
- 检查电源电压

### 2. 电源问题
**症状**: ESP32无法启动或工作不稳定
**检查**:
- 确认电源电压
- 检查连接质量
- 验证电流供应

**解决**:
- 使用稳定的电源
- 改善连接质量
- 增加电源容量

### 3. 状态指示问题
**症状**: 状态LED不亮或闪烁异常
**检查**:
- 确认LED连接
- 检查GPIO配置
- 验证程序逻辑

**解决**:
- 重新连接LED
- 检查程序代码
- 验证GPIO设置

## 📊 连接示意图

```
主设备系统:
┌─────────────────┐    ┌─────────────────┐
│   Mega2560      │    │      ESP32      │
│                 │    │                 │
│  TX2 (16) ──────┼────┼─→ RX (3)        │
│  RX2 (17) ←─────┼────┼── TX (1)        │
│  GND ───────────┼────┼── GND           │
│  5V ────────────┼────┼── VIN           │
│                 │    │                 │
│  [原始硬件]      │    │  GPIO2 ──→ LED  │
└─────────────────┘    └─────────────────┘

从设备系统:
┌─────────────────┐    ┌─────────────────┐
│   Mega2560      │    │      ESP32      │
│                 │    │                 │
│  TX2 (16) ──────┼────┼─→ RX (3)        │
│  RX2 (17) ←─────┼────┼── TX (1)        │
│  GND ───────────┼────┼── GND           │
│  5V ────────────┼────┼── VIN           │
│                 │    │                 │
│  Pin 4 ──→ 继电器 │    │  GPIO2 ──→ LED  │
│  Pin 13 ──→ LED  │    │                 │
│  Pin 5 ──→ 电机   │    │                 │
│  A0 ──→ 传感器    │    │                 │
│  Pin 2 ──→ 状态LED│    │                 │
└─────────────────┘    └─────────────────┘
```

## 🎯 总结

正确的硬件连接是系统正常运行的基础。请按照本指南逐步进行连接，并仔细检查每个连接点。如果遇到问题，请参考故障排除部分进行诊断和解决。

记住：
1. **仔细检查连接**: 确保每个连接都正确且牢固
2. **注意电压兼容性**: 使用ESP32的VIN引脚连接5V电源
3. **验证电源供应**: 确保有足够的电流供应
4. **测试通信**: 上传程序后测试串口通信是否正常
