# nRF24L01 模块接线指南

## 🔌 **完整接线图**

### 主控制器接线
```
Arduino Uno/Mega 2560     nRF24L01模块
┌─────────────────┐       ┌──────────────┐
│                 │       │              │
│ 3.3V ──────────→│  VCC  │              │
│ GND  ──────────→│  GND  │              │
│ Pin 7 ─────────→│  CE   │              │
│ Pin 8 ─────────→│  CSN  │              │
│ Pin 13 ────────→│  SCK  │              │
│ Pin 11 ────────→│ MOSI  │              │
│ Pin 12 ────────→│ MISO  │              │
│                 │       │              │
└─────────────────┘       └──────────────┘
```

### 子控制器接线（完全相同）
```
Arduino Uno/Mega 2560     nRF24L01模块
┌─────────────────┐       ┌──────────────┐
│                 │       │              │
│ 3.3V ──────────→│  VCC  │              │
│ GND  ──────────→│  GND  │              │
│ Pin 7 ─────────→│  CE   │              │
│ Pin 8 ─────────→│  CSN  │              │
│ Pin 13 ────────→│  SCK  │              │
│ Pin 11 ────────→│ MOSI  │              │
│ Pin 12 ────────→│ MISO  │              │
│                 │       │              │
└─────────────────┘       └──────────────┘
```

## 📋 **详细接线表**

| Arduino引脚 | nRF24L01引脚 | 功能说明 | 注意事项 |
|-------------|--------------|----------|----------|
| **3.3V** | **VCC** | 电源正极 | ⚠️ **必须是3.3V，不能接5V！** |
| **GND** | **GND** | 电源负极 | 确保良好接地 |
| **Pin 7** | **CE** | 芯片使能 | 数字输出引脚 |
| **Pin 8** | **CSN** | 片选信号 | 数字输出引脚 |
| **Pin 13** | **SCK** | 时钟信号 | SPI时钟线 |
| **Pin 11** | **MOSI** | 主出从入 | SPI数据线 |
| **Pin 12** | **MISO** | 主入从出 | SPI数据线 |

## ⚠️ **重要注意事项**

### 1. **电压要求**
- **必须使用3.3V供电**
- **绝对不能使用5V**
- 5V会烧坏nRF24L01模块

### 2. **引脚冲突检查**
根据您的Main(2).ino代码，检查以下引脚是否冲突：

#### 可能冲突的引脚：
- **Pin 7** - 代码中用作MotorPwmPin
- **Pin 11** - 代码中用作DT0
- **Pin 12** - 代码中用作DT1
- **Pin 13** - 代码中用作CLK2

## 🔧 **解决引脚冲突方案**

### 方案1：修改nRF24L01引脚（推荐）
```cpp
// 在代码中修改这些行：
RF24 radio(7, 8); // 改为其他可用引脚

// 例如改为：
RF24 radio(22, 23); // CE=22, CSN=23
```

### 方案2：修改原有引脚分配
如果必须使用Pin 7,11,12,13，需要修改Main(2).ino中的引脚定义：

```cpp
// 原代码中的引脚定义
#define MotorPwmPin 7   // 改为其他引脚
int DT0 = 11;          // 改为其他引脚  
int DT1 = 12;          // 改为其他引脚
int CLK2 = 13;         // 改为其他引脚
```

## 🎯 **推荐的引脚分配**

### 方案A：使用备用引脚
```cpp
// nRF24L01使用这些引脚
RF24 radio(22, 23); // CE=22, CSN=23

// 在代码中修改SPI引脚（如果需要）
// 通常SPI引脚是固定的，但可以尝试：
// SCK = 52 (Mega) 或 13 (Uno)
// MOSI = 51 (Mega) 或 11 (Uno)  
// MISO = 50 (Mega) 或 12 (Uno)
```

### 方案B：重新分配编码器引脚
```cpp
// 将编码器引脚改为其他可用引脚
int CLK0 = 2;   // 保持不变
int DT0 = 24;   // 从11改为24
int CLK1 = 3;   // 保持不变
int DT1 = 25;   // 从12改为25
int CLK2 = 26;  // 从21改为26
int DT2 = 13;   // 保持不变
int CLK3 = 20;  // 保持不变
int DT3 = 14;   // 保持不变
int CLK4 = 19;  // 保持不变
int DT20 = 15;  // 保持不变

// 电机引脚
#define MotorPwmPin 27  // 从7改为27
```

## 🔌 **实际接线步骤**

### 步骤1：准备材料
- 2个Arduino开发板
- 2个nRF24L01模块
- 杜邦线若干
- 面包板（可选）

### 步骤2：主控制器接线
1. 将nRF24L01模块放在面包板上
2. 按照接线表连接所有引脚
3. **特别注意VCC接3.3V**
4. 检查所有连接是否牢固

### 步骤3：子控制器接线
1. 重复步骤2的接线过程
2. 确保两个控制器的接线完全相同

### 步骤4：检查连接
```
检查清单：
□ VCC连接到3.3V（不是5V！）
□ GND连接到GND
□ CE连接到Pin 7（或修改后的引脚）
□ CSN连接到Pin 8（或修改后的引脚）
□ SCK连接到Pin 13
□ MOSI连接到Pin 11
□ MISO连接到Pin 12
□ 所有连接牢固
□ 没有短路
```

## 🚨 **常见错误和解决方案**

### 错误1：模块不工作
**原因**：接错电压
**解决**：检查VCC是否接3.3V

### 错误2：通信失败
**原因**：引脚冲突
**解决**：修改代码中的引脚定义

### 错误3：数据错误
**原因**：连接松动
**解决**：重新检查所有连接

### 错误4：配对失败
**原因**：两个模块地址不匹配
**解决**：确保代码中的地址设置正确

## 📝 **修改代码示例**

如果您选择修改引脚，需要在两个控制器代码中同时修改：

```cpp
// 在nRF24L01_主控制器.ino和nRF24L01_子控制器.ino中
// 找到这行：
RF24 radio(7, 8); // CE, CSN

// 改为：
RF24 radio(22, 23); // CE, CSN

// 同时修改引脚定义（如果需要）：
#define MotorPwmPin 27  // 从7改为27
int DT0 = 24;          // 从11改为24
int DT1 = 25;          // 从12改为25
int CLK2 = 26;         // 从21改为26
```

## 🎯 **最终建议**

1. **优先使用方案A**：修改nRF24L01引脚到22,23
2. **保持原有功能**：不修改编码器和电机引脚
3. **测试连接**：上传代码前先检查硬件连接
4. **逐步调试**：先测试单个模块，再测试通信

这样既能保持原有系统的完整性，又能成功集成nRF24L01通信功能！

