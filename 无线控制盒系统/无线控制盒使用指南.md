# 无线控制盒系统使用指南

## 系统概述

无线控制盒系统是一个基于433MHz无线通信的双控制盒解决方案，包含一个主控制盒和一个无线控制盒。两个控制盒之间可以进行实时通信和数据同步，实现远程控制和操作。

## 系统特点

- **双控制盒设计**：主控制盒 + 无线控制盒
- **433MHz无线通信**：稳定可靠的无线传输
- **实时同步**：控制盒之间的状态和数据同步
- **配对机制**：安全的设备配对和连接管理
- **多种控制模式**：支持按钮控制、编码器控制、无线控制
- **LED状态指示**：直观的连接状态和系统状态显示

## 硬件组成

### 主控制盒（MasterControlBox）
- 设备ID：1
- 功能：主要控制单元，负责系统核心功能
- 通信：433MHz无线发送/接收
- 接口：按钮、编码器、LED指示灯

### 无线控制盒（WirelessControlBox）
- 设备ID：2
- 功能：远程控制单元，与主控制盒通信
- 通信：433MHz无线发送/接收
- 接口：按钮、编码器、LED指示灯

## 引脚定义

### 按钮引脚
```
bt1 (31) - 配对/连接按键
bt2 (33) - 舵机控制
bt3 (35) - 模式切换
bt4 (37) - 紧急停止
bt5 (39) - 电机前进
bt6 (41) - 电机停止
bt7 (43) - 电机后退
```

### 电机控制引脚
```
MotorPwmPin (7)   - 电机PWM控制
MotorPwmPin2 (8)  - 电机PWM控制2
MotorPwmPin3 (10) - 电机PWM控制3
MotorIN1Pin (6)   - 电机方向控制1
MotorIN2Pin (5)   - 电机方向控制2
MotorIN3Pin (4)   - 电机方向控制3
SteerPwmPin (9)   - 舵机控制
```

### 编码器引脚
```
CLK0 (2)  - 编码器0时钟
DT0 (11)  - 编码器0数据
CLK1 (3)  - 编码器1时钟
DT1 (12)  - 编码器1数据
CLK2 (21) - 编码器2时钟
DT2 (13)  - 编码器2数据
CLK3 (20) - 编码器3时钟
DT3 (14)  - 编码器3数据
CLK4 (19) - 编码器4时钟
DT4 (15)  - 编码器4数据
CLK5 (18) - 编码器5时钟
DT5 (16)  - 编码器5数据
CLK6 (23) - 编码器6时钟
DT6 (17)  - 编码器6数据
```

### LED指示灯
```
led1 (22) - 绿色LED（连接状态）
led2 (24) - 黄色LED（未连接状态）
led3 (26) - 蓝色LED（配对状态）
```

## 安装和配置

### 1. 硬件连接

#### 主控制盒连接
1. 将Arduino板连接到电源
2. 连接按钮到对应引脚（31, 33, 35, 37, 39, 41, 43）
3. 连接电机驱动器到对应引脚（4, 5, 6, 7, 8, 10）
4. 连接舵机到引脚9
5. 连接编码器到对应引脚（2, 3, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 23）
6. 连接LED到引脚（22, 24, 26）
7. 连接433MHz无线模块到中断引脚0

#### 无线控制盒连接
1. 按照相同的引脚定义连接硬件
2. 确保433MHz无线模块正确连接

### 2. 软件配置

#### 主控制盒配置
1. 打开`MasterControlBox.ino`文件
2. 确认设备ID设置为`DEVICE_ID_1`
3. 编译并上传到主控制盒Arduino板

#### 无线控制盒配置
1. 打开`WirelessControlBox.ino`文件
2. 确认设备ID设置为`DEVICE_ID_2`
3. 编译并上传到无线控制盒Arduino板

## 使用操作

### 1. 系统启动

#### 主控制盒启动
1. 接通电源
2. 观察LED指示灯状态
   - 绿色LED亮起：系统正常
   - 黄色LED亮起：等待连接
   - 蓝色LED亮起：配对中

#### 无线控制盒启动
1. 接通电源
2. 观察LED指示灯状态
   - 绿色LED亮起：已连接
   - 黄色LED亮起：未连接
   - 蓝色LED亮起：配对中

### 2. 设备配对

#### 自动配对
1. 确保两个控制盒都已启动
2. 按下主控制盒的bt1按钮（配对按键）
3. 按下无线控制盒的bt1按钮（配对按键）
4. 观察蓝色LED闪烁，表示配对进行中
5. 配对成功后，绿色LED亮起

#### 手动配对
1. 在主控制盒上按下bt1按钮
2. 在无线控制盒上按下bt1按钮
3. 等待配对完成

### 3. 控制操作

#### 基本控制
- **舵机控制**：按下bt2按钮，舵机旋转10度
- **电机前进**：按下bt5按钮
- **电机停止**：按下bt6按钮
- **电机后退**：按下bt7按钮
- **紧急停止**：按下bt4按钮

#### 模式切换
- **同步模式**：按下bt3按钮切换同步模式
- **连接管理**：按下bt1按钮连接/断开设备

### 4. 状态监控

#### LED状态指示
- **绿色LED**：设备已连接，系统正常
- **黄色LED**：设备未连接，等待配对
- **蓝色LED**：配对进行中

#### 串口监控
通过串口监视器可以查看：
- 设备信息
- 连接状态
- 指令执行情况
- 系统状态报告

## 通信协议

### 指令格式
```
[设备ID (8位)] [指令类型 (8位)] [参数 (8位)]
```

### 指令类型
```
CMD_LED_ON = 0x01        - 开启LED
CMD_LED_OFF = 0x02       - 关闭LED
CMD_MOTOR_FWD = 0x03     - 电机前进
CMD_MOTOR_BWD = 0x04     - 电机后退
CMD_MOTOR_STOP = 0x05    - 电机停止
CMD_SERVO_LEFT = 0x06    - 舵机左转
CMD_SERVO_RIGHT = 0x07   - 舵机右转
CMD_SPEED_UP = 0x08      - 速度增加
CMD_SPEED_DOWN = 0x09    - 速度减少
CMD_STATUS = 0x0A        - 状态查询
CMD_RECORD = 0x0B        - 记录参数
CMD_RESET = 0x0C         - 系统重置
CMD_EMERGENCY_STOP = 0x0D - 紧急停止
CMD_PAIR_REQUEST = 0x0E  - 配对请求
```

## 故障排除

### 常见问题

#### 1. 设备无法配对
- 检查433MHz无线模块连接
- 确认设备ID设置正确
- 检查电源供应
- 重新启动设备

#### 2. 连接不稳定
- 检查无线模块天线
- 确认设备间距离（建议<50米）
- 检查环境干扰
- 重新配对设备

#### 3. 控制无响应
- 检查按钮连接
- 确认设备已配对
- 检查LED状态指示
- 重启设备

#### 4. 电机不工作
- 检查电机驱动器连接
- 确认电源供应充足
- 检查PWM引脚连接
- 测试电机驱动器

### 调试方法

#### 串口调试
1. 打开串口监视器
2. 设置波特率为9600
3. 观察系统输出信息
4. 根据错误信息进行排查

#### LED调试
1. 观察LED状态指示
2. 根据LED状态判断问题
3. 参考LED状态说明

## 维护保养

### 定期检查
1. 检查硬件连接
2. 清洁设备表面
3. 检查电源供应
4. 测试无线通信

### 软件更新
1. 备份当前配置
2. 下载最新固件
3. 更新设备固件
4. 测试系统功能

## 技术规格

### 电气规格
- 工作电压：5V DC
- 工作电流：<500mA
- 通信频率：433MHz
- 通信距离：<50米

### 机械规格
- 控制盒尺寸：根据实际需求
- 重量：根据实际需求
- 防护等级：IP20

### 环境要求
- 工作温度：-10°C ~ +50°C
- 工作湿度：20% ~ 80% RH
- 存储温度：-20°C ~ +60°C

## 联系支持

如有技术问题或需要支持，请联系：
- 技术支持邮箱：[技术支持邮箱]
- 技术支持电话：[技术支持电话]
- 在线支持：[在线支持链接]
