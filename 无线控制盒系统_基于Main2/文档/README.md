# 无线控制盒系统 - 基于Main(2).ino

## 项目简介

本项目基于 `Main(2).ino` 文件开发，实现了主控制器和无线控制盒之间的无线通信功能。系统采用433MHz无线通信技术，支持实时数据传输和状态同步，为现有的控制盒系统添加了无线控制能力。

## 主要特性

- 🔄 **无线通信**：基于433MHz的无线数据传输
- 🎯 **实时同步**：主控制器和无线控制盒状态实时同步
- 🔐 **自动配对**：设备自动配对和连接管理
- 📊 **状态监控**：实时监控设备状态和参数
- 🎮 **远程控制**：支持远程控制所有功能
- 💾 **参数存储**：支持参数保存和恢复
- 🛡️ **安全可靠**：具备连接超时和错误处理机制

## 系统架构

```
┌─────────────────┐   433MHz    ┌─────────────────┐
│   主控制器      │ ◄─────────► │   无线控制盒    │
│  (Master)       │   无线通信   │   (Slave)       │
│                 │             │                 │
│ • 电机控制      │             │ • 电机控制      │
│ • 舵机控制      │             │ • 舵机控制      │
│ • 编码器读取    │             │ • 编码器读取    │
│ • 参数存储      │             │ • 参数存储      │
│ • 状态显示      │             │ • 状态显示      │
└─────────────────┘             └─────────────────┘
```

## 文件结构

```
无线控制盒系统_基于Main2/
├── Main_Wireless_Master.ino    # 主控制器无线版本
├── WirelessControlBox.ino      # 无线控制盒版本
├── 使用指南.md                 # 详细使用指南
└── README.md                   # 项目说明文档
```

## 硬件要求

### 主控制器
- Arduino Mega 2560 或兼容板
- 433MHz无线接收/发射模块
- 5个编码器
- 3个数码管显示模块
- 5个按键
- 1个舵机
- 1个电机驱动模块

### 无线控制盒
- Arduino Mega 2560 或兼容板
- 433MHz无线接收/发射模块
- 5个编码器
- 3个数码管显示模块
- 5个按键
- 1个舵机
- 1个电机驱动模块

## 快速开始

### 1. 硬件连接

#### 主控制器连接
1. 将433MHz无线接收模块连接到Arduino的引脚0（中断引脚）
2. 将433MHz无线发射模块连接到Arduino的引脚1
3. 按照引脚定义连接编码器、按键、电机、舵机和数码管

#### 无线控制盒连接
1. 将433MHz无线接收模块连接到Arduino的引脚0（中断引脚）
2. 将433MHz无线发射模块连接到Arduino的引脚1
3. 按照引脚定义连接编码器、按键、电机、舵机和数码管

### 2. 软件安装

#### 主控制器
1. 打开Arduino IDE
2. 加载 `Main_Wireless_Master.ino` 文件
3. 确保已安装所需库文件
4. 编译并上传到主控制器

#### 无线控制盒
1. 打开Arduino IDE
2. 加载 `WirelessControlBox.ino` 文件
3. 确保已安装所需库文件
4. 编译并上传到无线控制盒

### 3. 系统启动

1. 接通主控制器电源
2. 接通无线控制盒电源
3. 观察串口输出，确认系统初始化完成
4. 等待设备自动配对

## 功能说明

### 主控制器功能
- 接收无线控制盒的命令
- 控制电机和舵机
- 读取编码器数据
- 存储和恢复参数
- 显示系统状态
- 发送状态数据给无线控制盒

### 无线控制盒功能
- 发送控制命令给主控制器
- 接收主控制器的状态数据
- 控制电机和舵机
- 读取编码器数据
- 显示系统状态
- 自动配对和连接管理

## 通信协议

### 命令格式
```cpp
// 32位命令结构
// [设备ID (8位)] [命令类型 (8位)] [参数 (8位)] [保留 (8位)]
uint32_t command = (deviceId << 16) | (commandType << 8) | parameter;
```

### 设备ID
- `DEVICE_ID_1`：主控制器
- `DEVICE_ID_2`：无线控制盒
- `DEVICE_ID_ALL`：所有设备

### 命令类型
- `CMD_LED_ON/OFF`：LED控制
- `CMD_MOTOR_FWD/BWD/STOP`：电机控制
- `CMD_SERVO_LEFT/RIGHT`：舵机控制
- `CMD_SPEED_UP/DOWN`：速度控制
- `CMD_STATUS`：状态查询
- `CMD_RECORD`：记录参数
- `CMD_RESET`：重置系统
- `CMD_EMERGENCY_STOP`：紧急停止
- `CMD_PAIR_REQUEST`：配对请求

## 使用说明

### 编码器控制
- **编码器0**：舵机角度控制（0-300度）
- **编码器1**：舵机速度控制（0-99）
- **编码器2**：舵机时间控制（0-25秒）
- **编码器3**：舵机中位控制（1100-2000）
- **编码器4**：电机速度控制（0-99）

### 按键功能
- **按键1**：记录参数
- **按键2**：舵机开关
- **按键3**：时间设置
- **按键4**：舵机开关
- **按键5**：电机开关

### 显示说明
- **数码管1**：显示舵机左右停留时间（L.R格式）
- **数码管2**：显示舵机角度和速度（AS格式）
- **数码管3**：显示电机速度（MS格式）

## 故障排除

### 常见问题

1. **无法建立无线连接**
   - 检查433MHz模块连接
   - 确认模块供电正常
   - 检查天线连接
   - 确认设备距离

2. **无线连接不稳定**
   - 检查周围干扰源
   - 确认天线完好
   - 调整设备距离
   - 检查电源稳定

3. **编码器数值异常**
   - 检查编码器连接
   - 确认编码器供电
   - 检查编码器损坏
   - 重新校准编码器

4. **电机/舵机不工作**
   - 检查驱动模块连接
   - 确认供电正常
   - 检查设备损坏
   - 确认控制信号

## 技术规格

### 通信规格
- **频率**：433MHz
- **调制方式**：ASK
- **传输距离**：100米（开阔地）
- **数据速率**：1.2kbps
- **工作电压**：3.3V-5V

### 系统规格
- **工作电压**：5V
- **工作电流**：<500mA
- **工作温度**：-10°C ~ +50°C
- **存储温度**：-20°C ~ +70°C
- **湿度范围**：20% ~ 80% RH

## 版本历史

### v1.0 (2024年)
- 初始版本发布
- 基于Main(2).ino开发
- 实现基本无线通信功能
- 支持实时状态同步
- 支持自动配对功能

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进项目。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件
- 技术支持

## 致谢

感谢所有为项目做出贡献的开发者和用户。
