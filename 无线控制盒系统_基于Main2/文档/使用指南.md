# 无线控制盒系统使用指南

## 系统概述

本系统基于 `Main(2).ino` 文件开发，实现了主控制器和无线控制盒之间的无线通信功能。系统采用433MHz无线通信技术，支持实时数据传输和状态同步。

## 文件结构

```
无线控制盒系统_基于Main2/
├── Main_Wireless_Master.ino    # 主控制器无线版本
├── WirelessControlBox.ino      # 无线控制盒版本
└── 使用指南.md                 # 本使用指南
```

## 硬件要求

### 主控制器硬件
- Arduino Mega 2560 或兼容板
- 433MHz无线接收模块
- 433MHz无线发射模块
- 5个编码器
- 3个数码管显示模块
- 5个按键
- 1个舵机
- 1个电机驱动模块
- 相关连接线

### 无线控制盒硬件
- Arduino Mega 2560 或兼容板
- 433MHz无线接收模块
- 433MHz无线发射模块
- 5个编码器
- 3个数码管显示模块
- 5个按键
- 1个舵机
- 1个电机驱动模块
- 相关连接线

## 引脚定义

### 主控制器引脚
```cpp
// 编码器引脚
#define CLK0 2   // 编码器0 CLK
#define DT0 11   // 编码器0 DT
#define CLK1 3   // 编码器1 CLK
#define DT1 12   // 编码器1 DT
#define CLK2 21  // 编码器2 CLK
#define DT2 13   // 编码器2 DT
#define CLK3 20  // 编码器3 CLK
#define DT3 14   // 编码器3 DT
#define CLK4 19  // 编码器4 CLK
#define DT4 15   // 编码器4 DT

// 按键引脚
#define bt1 31   // 记录参数按键
#define bt2 33   // 舵机开关按键
#define bt3 35   // 时间设置按键
#define bt4 37   // 舵机开关按键
#define bt5 39   // 电机开关按键

// 电机引脚
#define MotorPwmPin 7   // 电机PWM输出
#define MotorIN1Pin 6   // 电机IN1控制
#define MotorIN2Pin 5   // 电机IN2控制
#define MotorIN3Pin 4   // 电机IN3控制

// 舵机引脚
#define SteerPwmPin 9   // 舵机PWM输出

// 数码管引脚
// 数码管1: 36, 34, 32
// 数码管2: 26, 24, 22
// 数码管3: 46, 44, 42
```

### 无线控制盒引脚
与主控制器相同

## 安装步骤

### 1. 硬件连接

#### 433MHz发射接收一体模块接线说明

**重要**：433MHz发射接收一体模块有5个引脚，但实际只需要使用4个引脚进行基本通信。

##### 发射接收一体模块接线（必需）
```
发射接收一体模块引脚    →    Arduino引脚
VCC                   →    5V 或 3.3V
GND                   →    GND
TXD                   →    引脚29（发送）
RXD                   →    引脚28（接收）
ANT                   →    不连接（可选，用于提高传输距离）
```

**重要说明：** 新的引脚配置（28,29）避免了与编码器、LED和硬件串口的冲突，确保通信稳定可靠。

##### 天线连接（可选）
- **材料**：可以使用导线、铜线或专用天线
- **长度**：建议17.3cm（1/4波长）
- **方向**：垂直放置效果最佳
- **作用**：提高信号传输距离和稳定性

#### 主控制器连接
1. **433MHz发射接收一体模块连接**：
   - 模块VCC连接到5V
   - 模块GND连接到GND
   - 模块RXD连接到引脚0
   - 模块TXD连接到引脚1
2. 按照引脚定义连接编码器、按键、电机、舵机和数码管
3. 确保所有连接牢固，避免虚接

#### 无线控制盒连接
1. **433MHz发射接收一体模块连接**：
   - 模块VCC连接到5V
   - 模块GND连接到GND
   - 模块RXD连接到引脚0
   - 模块TXD连接到引脚1
2. 按照引脚定义连接编码器、按键、电机、舵机和数码管
3. 确保所有连接牢固，避免虚接

### 2. 软件安装

#### 主控制器
1. 打开Arduino IDE
2. 加载 `Main_Wireless_Master.ino` 文件
3. 确保已安装以下库：
   - FBLed
   - DeviceConfig
   - Servo
   - myButton
   - KeyValueEEPROM
   - EEPROM
   - RCSwitch
4. 编译并上传到主控制器

#### 无线控制盒
1. 打开Arduino IDE
2. 加载 `WirelessControlBox.ino` 文件
3. 确保已安装以下库：
   - FBLed
   - DeviceConfig
   - Servo
   - myButton
   - KeyValueEEPROM
   - EEPROM
   - RCSwitch
4. 编译并上传到无线控制盒

## 使用说明

### 1. 系统启动

#### 主控制器启动
1. 接通主控制器电源
2. 观察串口输出，确认系统初始化完成
3. 等待无线控制盒配对

#### 无线控制盒启动
1. 接通无线控制盒电源
2. 观察串口输出，确认系统初始化完成
3. 系统会自动尝试与主控制器配对

### 2. 配对过程

1. 无线控制盒启动后会自动发送配对请求
2. 主控制器收到配对请求后会发送配对确认
3. 配对成功后，两个设备会建立无线连接
4. 配对状态会通过串口输出显示

### 3. 操作说明

#### 主控制器操作
- **按键1**：记录当前参数到EEPROM
- **按键2**：舵机开关控制
- **按键3**：时间设置切换
- **按键4**：舵机开关控制
- **按键5**：电机开关控制

#### 无线控制盒操作
- **按键1**：发送记录参数命令给主控制器
- **按键2**：发送舵机开关命令给主控制器
- **按键3**：时间设置切换
- **按键4**：发送舵机开关命令给主控制器
- **按键5**：发送电机开关命令给主控制器

### 4. 编码器控制

#### 编码器0：舵机角度控制
- 旋转编码器0可以调节舵机的摆动角度
- 角度范围：0-300度

#### 编码器1：舵机速度控制
- 旋转编码器1可以调节舵机的摆动速度
- 速度范围：0-99

#### 编码器2：舵机时间控制
- 旋转编码器2可以调节舵机的停留时间
- 时间范围：0-25秒

#### 编码器3：舵机中位控制
- 旋转编码器3可以调节舵机的中位位置
- 位置范围：1100-2000

#### 编码器4：电机速度控制
- 旋转编码器4可以调节电机的转速
- 速度范围：0-99

### 5. 显示说明

#### 数码管1显示
- 显示格式：`L.R`（左时间.右时间）
- 显示舵机的左右停留时间

#### 数码管2显示
- 显示格式：`AS`（角度 速度）
- 显示舵机的角度和速度

#### 数码管3显示
- 显示格式：`MS`（电机速度）
- 显示电机的当前速度

## 通信协议

### 命令格式
```cpp
// 命令结构：32位
// [设备ID (8位)] [命令类型 (8位)] [参数 (8位)] [保留 (8位)]
uint32_t command = (deviceId << 16) | (commandType << 8) | parameter;
```

### 设备ID
- `DEVICE_ID_1`：主控制器
- `DEVICE_ID_2`：无线控制盒
- `DEVICE_ID_ALL`：所有设备

### 命令类型
- `CMD_LED_ON`：LED开启
- `CMD_LED_OFF`：LED关闭
- `CMD_MOTOR_FWD`：电机前进
- `CMD_MOTOR_BWD`：电机后退
- `CMD_MOTOR_STOP`：电机停止
- `CMD_SERVO_LEFT`：舵机左转
- `CMD_SERVO_RIGHT`：舵机右转
- `CMD_SPEED_UP`：速度增加
- `CMD_SPEED_DOWN`：速度减少
- `CMD_STATUS`：状态查询
- `CMD_RECORD`：记录参数
- `CMD_RESET`：重置系统
- `CMD_EMERGENCY_STOP`：紧急停止
- `CMD_PAIR_REQUEST`：配对请求

## 故障排除

### 1. 无线连接问题

#### 问题：无法建立无线连接
**解决方案：**
1. 检查433MHz模块连接是否正确
2. 确认模块供电是否正常
3. 检查天线是否连接
4. 确认两个设备距离是否过远
5. 重启设备重新配对

#### 问题：无线连接不稳定
**解决方案：**
1. 检查周围是否有干扰源
2. 确认模块天线是否损坏
3. 调整设备之间的距离
4. 检查电源供电是否稳定

### 2. 编码器问题

#### 问题：编码器数值异常
**解决方案：**
1. 检查编码器连接是否正确
2. 确认编码器供电是否正常
3. 检查编码器是否损坏
4. 重新校准编码器

### 3. 电机问题

#### 问题：电机不转动
**解决方案：**
1. 检查电机驱动模块连接
2. 确认电机供电是否正常
3. 检查电机是否损坏
4. 确认控制信号是否正确

### 4. 舵机问题

#### 问题：舵机不转动
**解决方案：**
1. 检查舵机连接是否正确
2. 确认舵机供电是否正常
3. 检查舵机是否损坏
4. 确认控制信号是否正确

## 维护保养

### 1. 定期检查
- 每月检查一次硬件连接
- 每季度清洁一次设备
- 每年更换一次电池（如果使用电池供电）

### 2. 软件更新
- 定期检查是否有软件更新
- 备份重要参数设置
- 记录系统配置信息

### 3. 故障记录
- 记录故障现象和解决方案
- 建立故障数据库
- 定期分析故障原因

## 技术支持

如遇到问题，请按以下步骤进行：

1. 查看本使用指南的故障排除部分
2. 检查硬件连接和供电
3. 查看串口输出的错误信息
4. 联系技术支持团队

## 版本信息

- 版本：1.0
- 发布日期：2024年
- 基于：Main(2).ino
- 开发语言：Arduino C++
