# 无线焊接设备控制系统 - 完整版使用指南

## 系统概述

本系统基于433MHz无线通信，实现了焊接设备的远程控制。系统包含两个主要组件：

1. **主控制器** (`Main_Wireless_Master_完整版.ino`) - 发送控制指令
2. **无线控制盒** (`WirelessControlBox_完整版.ino`) - 接收指令并控制焊接设备

**完整版特点**：
- ✅ 与Main(2).ino完全相同的功能逻辑
- ✅ 完整的数码管显示功能
- ✅ 完整的按键处理功能
- ✅ 完整的编码器控制功能
- ✅ 增加433MHz无线通信功能
- ✅ 无线控制和本地控制并存

## 硬件连接

### 主控制器 (Main_Wireless_Master_完整版)
```
Arduino Mega 2560    →    433MHz发射接收一体模块
引脚16 (TX)         →    RXD
引脚17 (RX)         →    TXD
GND                 →    GND
5V/3.3V             →    VCC

按键连接：
bt1 (31) - 配对按键
bt2 (33) - 设备状态查询
bt3 (35) - 发送控制指令
bt4 (37) - 参数设置
bt5 (39) - 紧急停止
```

### 无线控制盒 (WirelessControlBox_完整版)
```
Arduino Mega 2560    →    433MHz发射接收一体模块
引脚16 (TX)         →    RXD
引脚17 (RX)         →    TXD
GND                 →    GND
5V/3.3V             →    VCC

焊接设备连接：
- 舵机控制：引脚9
- 电机控制：引脚4,5,6,7
- 编码器：引脚2,3,11,12,13,14,15,19,20,21
- 数码管：引脚22,24,26,32,34,36,42,44,46
- 按键：引脚31,33,35,37,39
```

## 系统功能

### 主控制器功能
1. **配对管理**
   - 长按bt1键3秒进入配对模式
   - 自动发送配对请求
   - 配对状态持久化存储

2. **设备控制**
   - bt2: 查询设备状态
   - bt3: 发送控制指令
   - bt4: 显示控制参数
   - bt5: 紧急停止

3. **通信管理**
   - 定期发送心跳信号
   - 监听设备响应
   - 自动重连机制

### 无线控制盒功能
1. **焊接设备控制** (与Main(2).ino完全相同)
   - 舵机摆动控制（角度、速度、停留时间）
   - 电机速度控制
   - 参数实时调整
   - 数码管状态显示
   - 编码器控制
   - 按键控制

2. **无线通信**
   - 接收主控制器指令
   - 发送设备状态
   - 心跳响应
   - 配对确认

3. **参数管理**
   - EEPROM参数存储
   - 参数恢复
   - 实时参数调整

## 使用步骤

### 1. 系统初始化
1. 将 `Main_Wireless_Master_完整版.ino` 上传到主控制器
2. 将 `WirelessControlBox_完整版.ino` 上传到无线控制盒
3. 连接433MHz模块和焊接设备
4. 上电启动

### 2. 设备配对
1. 在主控制器上长按bt1键3秒
2. 观察串口输出，确认进入配对模式
3. 等待配对成功提示
4. 配对状态会自动保存到EEPROM

### 3. 设备控制
1. **状态查询**：按bt2键查询设备当前状态
2. **发送指令**：按bt3键发送控制指令
3. **参数设置**：按bt4键查看当前控制参数
4. **紧急停止**：按bt5键立即停止所有设备

### 4. 焊接设备操作 (与Main(2).ino完全相同)
1. 使用编码器调整焊接参数：
   - 编码器0：舵机角度
   - 编码器1：舵机速度
   - 编码器2：停留时间
   - 编码器3：中位点
   - 编码器4：电机速度

2. 使用按键控制：
   - bt1：保存参数到EEPROM
   - bt4：舵机开关
   - bt3：时间设置模式切换
   - bt5：电机开关

3. 数码管显示：
   - 显示当前角度、速度、时间等参数
   - 实时更新显示内容

## 通信协议

### 数据帧格式
```
起始标志: 0xFD
命令类型: 0x03/0x04/0x05
设备ID: 0xD5 0xAA 0x55
数据字节: 0x96/0x97/0x98/0x99/0xA0-0xA7
结束标志: 0xDF
```

### 命令定义
- `0x96`: 配对请求
- `0x97`: 配对确认
- `0x98`: 心跳信号
- `0x99`: 控制指令
- `0xA0`: 舵机开启
- `0xA1`: 舵机关闭
- `0xA2`: 电机开启
- `0xA3`: 电机关闭
- `0xA4`: 设置角度
- `0xA5`: 设置速度
- `0xA6`: 设置时间
- `0xA7`: 紧急停止

## 功能对比

| 功能 | Main(2).ino | 完整版 | 说明 |
|------|-------------|--------|------|
| 编码器控制 | ✅ | ✅ | 完全相同 |
| 按键控制 | ✅ | ✅ | 完全相同 |
| 数码管显示 | ✅ | ✅ | 完全相同 |
| 舵机控制 | ✅ | ✅ | 完全相同 |
| 电机控制 | ✅ | ✅ | 完全相同 |
| EEPROM存储 | ✅ | ✅ | 完全相同 |
| 参数设置 | ✅ | ✅ | 完全相同 |
| 433MHz通信 | ❌ | ✅ | 新增功能 |
| 无线配对 | ❌ | ✅ | 新增功能 |
| 远程控制 | ❌ | ✅ | 新增功能 |
| 心跳监控 | ❌ | ✅ | 新增功能 |

## 故障排除

### 配对失败
1. 检查433MHz模块连接
2. 确认模块供电正常
3. 重新进入配对模式
4. 检查串口输出错误信息

### 通信中断
1. 检查心跳信号是否正常
2. 确认设备在通信范围内
3. 重新配对设备
4. 检查433MHz模块状态

### 设备控制异常
1. 检查焊接设备连接
2. 确认参数设置正确
3. 使用紧急停止功能
4. 重新初始化设备

### 数码管显示异常
1. 检查数码管连接
2. 确认引脚配置正确
3. 检查FBLed库文件
4. 重新上传程序

## 注意事项

1. **安全操作**
   - 使用前确保设备连接正确
   - 紧急情况下立即按bt5键停止
   - 定期检查设备状态

2. **通信距离**
   - 433MHz通信距离约100-500米
   - 避免金属障碍物干扰
   - 保持天线方向正确

3. **参数设置**
   - 参数修改后及时保存
   - 避免极端参数值
   - 定期备份重要参数

4. **维护保养**
   - 定期检查连接线
   - 清洁设备表面
   - 更新固件版本

## 技术支持

如遇到问题，请检查：
1. 串口输出信息
2. 设备连接状态
3. 参数设置正确性
4. 通信信号强度

系统设计基于稳定的433MHz通信协议，确保可靠的无线控制功能，同时保持与Main(2).ino完全相同的本地控制功能。
