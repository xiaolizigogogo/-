# ESP32 + Mega 2560 接线指南

## 系统概述

本系统使用ESP32作为主控制器，通过WiFi提供Web界面控制，通过串口与Mega 2560通信，由Mega 2560执行具体的硬件控制任务。

## 硬件清单

### 主控制器（ESP32）
- ESP32开发板 × 1
- 电源适配器（5V/2A） × 1
- 杜邦线若干

### 从控制器（Mega 2560）
- Arduino Mega 2560开发板 × 1
- 电机驱动模块（如L298N） × 2
- 直流电机 × 2
- LED指示灯 × 1
- 温度传感器（如DS18B20） × 1
- 湿度传感器（如DHT22） × 1
- 杜邦线若干

## 接线方案

### 1. ESP32与Mega 2560串口连接

```
ESP32          Mega 2560
------         ---------
GPIO16 (RX) →  GPIO19 (TX)
GPIO17 (TX) →  GPIO18 (RX)
GND          →  GND
3.3V         →  3.3V (可选，为Mega 2560提供参考电压)
```

**注意：**
- ESP32的3.3V逻辑电平与Mega 2560的5V逻辑电平兼容
- 建议共地连接以确保信号稳定
- 串口通信波特率：9600

### 2. Mega 2560电机控制接线

#### 电机1控制
```
Mega 2560     L298N模块
---------     ---------
数字引脚2  →  ENA (使能A)
数字引脚3  →  IN1 (输入1)
数字引脚4  →  IN2 (输入2)
数字引脚5  →  PWM (PWM控制)
GND        →  GND
5V         →  VCC
```

#### 电机2控制
```
Mega 2560     L298N模块
---------     ---------
数字引脚6  →  ENB (使能B)
数字引脚7  →  IN3 (输入3)
数字引脚8  →  IN4 (输入4)
数字引脚9  →  PWM (PWM控制)
GND        →  GND
5V         →  VCC
```

#### 电机连接
```
L298N模块    直流电机
---------    --------
OUT1      →  电机1正极
OUT2      →  电机1负极
OUT3      →  电机2正极
OUT4      →  电机2负极
```

### 3. LED指示灯接线

```
Mega 2560     LED
---------     ---
数字引脚13 →  LED正极
GND        →  LED负极（通过限流电阻）
```

### 4. 传感器接线

#### 温度传感器（DS18B20）
```
Mega 2560     DS18B20
---------     -------
模拟引脚A0 →  数据引脚
5V         →  VCC
GND        →  GND
```

#### 湿度传感器（DHT22）
```
Mega 2560     DHT22
---------     -----
模拟引脚A1 →  数据引脚
5V         →  VCC
GND        →  GND
```

## 电源方案

### 方案1：独立供电
- ESP32：通过USB或5V适配器供电
- Mega 2560：通过USB或7-12V适配器供电
- 电机：通过L298N模块的电源接口供电（7-12V）

### 方案2：统一供电
- 使用12V/3A电源适配器
- 通过电压转换模块为ESP32提供5V电源
- 通过L298N模块为电机提供12V电源
- Mega 2560通过Vin引脚供电

## 引脚分配表

### ESP32引脚分配
| 功能 | 引脚 | 说明 |
|------|------|------|
| 串口RX | GPIO16 | 接收Mega 2560数据 |
| 串口TX | GPIO17 | 发送数据到Mega 2560 |
| WiFi | 内置 | WiFi通信 |
| 电源 | 5V | 外部电源输入 |

### Mega 2560引脚分配
| 功能 | 引脚 | 说明 |
|------|------|------|
| 串口RX | GPIO18 | 接收ESP32数据 |
| 串口TX | GPIO19 | 发送数据到ESP32 |
| 电机1使能 | 数字引脚2 | 电机1使能控制 |
| 电机1方向1 | 数字引脚3 | 电机1方向控制 |
| 电机1方向2 | 数字引脚4 | 电机1方向控制 |
| 电机1PWM | 数字引脚5 | 电机1速度控制 |
| 电机2使能 | 数字引脚6 | 电机2使能控制 |
| 电机2方向1 | 数字引脚7 | 电机2方向控制 |
| 电机2方向2 | 数字引脚8 | 电机2方向控制 |
| 电机2PWM | 数字引脚9 | 电机2速度控制 |
| LED | 数字引脚13 | LED状态指示 |
| 温度传感器 | 模拟引脚A0 | 温度数据读取 |
| 湿度传感器 | 模拟引脚A1 | 湿度数据读取 |

## 接线注意事项

### 1. 电源安全
- 确保所有设备共地连接
- 电机电源与逻辑电源分离
- 使用合适的电源容量

### 2. 信号完整性
- 串口连接线尽量短
- 避免与电机电源线平行走线
- 使用屏蔽线减少干扰

### 3. 机械安全
- 电机安装牢固
- 避免电机堵转
- 提供紧急停止功能

### 4. 调试建议
- 先测试串口通信
- 再测试电机控制
- 最后测试传感器读取

## 故障排除

### 1. 串口通信问题
- 检查接线是否正确
- 确认波特率设置（9600）
- 检查共地连接

### 2. 电机不转
- 检查电机驱动模块电源
- 确认PWM信号输出
- 检查电机连接

### 3. 传感器读数异常
- 检查传感器电源
- 确认模拟引脚连接
- 检查传感器是否损坏

### 4. WiFi连接问题
- 检查WiFi密码
- 确认信号强度
- 重启ESP32

## 扩展建议

### 1. 添加更多设备
- 使用I2C总线连接多个传感器
- 使用SPI总线连接显示模块
- 添加更多电机控制通道

### 2. 提高可靠性
- 添加看门狗功能
- 实现数据校验
- 添加故障恢复机制

### 3. 增强功能
- 添加数据记录功能
- 实现远程固件更新
- 添加安全认证机制





