# 无线控制盒新配对方式使用说明

## 概述
重新设计了433MHz无线通信的配对逻辑，采用手动配对模式，更加可靠和直观。

## 配对方法

### 1. 配对步骤
1. **无线控制盒**：长按bt1键3秒进入配对模式
2. **主控制器**：长按bt1键3秒进入配对模式  
3. 两个设备会自动检测并完成配对
4. 配对成功后进入正常工作状态

### 2. 配对状态指示
- **配对模式**：串口监视器显示"进入配对模式"
- **配对成功**：串口监视器显示"配对成功！"
- **配对超时**：30秒后自动退出配对模式

## 技术改进

### 1. 配对逻辑优化
- 移除了自动配对，改为手动触发
- 配对模式持续30秒，超时自动退出
- 配对期间每1秒发送一次配对请求
- 配对成功后立即退出配对模式

### 2. 按键功能
- **短按bt1**：正常功能（记录参数/发送命令）
- **长按bt1（3秒）**：进入配对模式

### 3. 通信协议
- 配对请求：`FD 0E 00 00 00 00 DF`
- 配对确认：`FD 0F 00 00 00 00 DF`
- 0xF0响应：433MHz模块的正常确认，会被忽略

## 使用方法

### 1. 首次配对
1. 给两个设备上电
2. 打开串口监视器（115200波特率）
3. 无线控制盒长按bt1键3秒
4. 主控制器长按bt1键3秒
5. 观察串口输出确认配对成功

### 2. 重新配对
如果配对丢失或需要重新配对：
1. 两个设备都长按bt1键3秒进入配对模式
2. 等待配对完成

### 3. 正常工作
配对成功后：
- 无线控制盒可以发送控制命令
- 主控制器可以接收并执行命令
- 编码器数据会自动同步

## 故障排除

### 1. 配对失败
- 检查433MHz模块接线（TXD→16, RXD→17）
- 确认两个设备都进入了配对模式
- 检查串口监视器输出
- 确保使用Arduino Mega 2560板子

### 2. 通信中断
- 检查电源连接
- 重新进行配对
- 检查433MHz模块工作状态

### 3. 按键无响应
- 检查bt1按键连接
- 确认按键按下时间足够长（3秒）
- 观察串口输出确认按键检测

## 文件说明

### 修改的文件
- `WirelessControlBox.ino` - 无线控制盒程序
- `Main_Wireless_Master.ino` - 主控制器程序

### 主要改进
1. 添加了配对模式状态管理
2. 实现了长按检测逻辑
3. 优化了配对流程
4. 改进了错误处理和提示信息

## 注意事项
1. 配对时两个设备必须同时进入配对模式
2. 配对模式有30秒超时限制
3. 配对成功后需要重新配对才能连接其他设备
4. 确保433MHz模块工作正常
5. 使用Arduino Mega 2560板子以获得Serial2支持
